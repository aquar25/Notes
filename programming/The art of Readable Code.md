## The art of Readable Code##

代码要容易理解，最好能让其他人可以用最少的时间理解你的代码。

可读的标准：以别人阅读理解你的代码的时间作为衡量代码可读性的标准，我们的目标是减小这个时间。`Time-Till-Understanding`

理解的标准：别人能够有效的更改你的代码，或者指出代码中的bug，明白你的代码是怎么和系统中的其他代码交互的。

别人：其他同事，6个月之后的你自己

理论上，代码越少，理解代码所用的时间也就越少，和读书类似，所以这本书就很少吧。但是，这不是绝对的，一些被简化的逻辑，如果写的时候优化了原来复杂的逻辑，直接看懂就会花费很长时间。这时加上一句简单的注释就可以提高很多效率。

代码可读的基本准则高于本书中的其他所有原则。

### 表面上的改进

#### 见名知意

* 选择具体的/明确的词，例如使用`DownloadPage()`，而不是宽泛的`GetPage()`。要根据功能的具体特点取名字，可以区分这个函数的功能和其他的特别之处。也可以选择使用行业相关的专业词汇。英语词汇量是个问题。
* 使用更有表现力的词汇。可以通过在词典中找同义词的方法。
  * send: deliver, dispatch, announce, distribute, route
  * find: search, extract, locate, recover
  * start: launch, create, begin, open
  * make: create, setup, build, generate, compose, add, new, fill
* 使用具体的名字名字来描述事物，清晰明确的词汇比卡哇伊/空洞的词汇好。
* 给变量名带上必须的细节，循环变量可以加前缀区分是用来遍历哪个数据
* 名字优先表达实际作用，其次时使用场景，因为使用场景可能有多种
* 名字附带有效的关键信息，例如单位(time_s)/数据类型(p)/格式(utf8)
* 作用域大的名字要更具体，作用域小的可以简短的名字
* 利用名字的格式来传递含义。遵守统一的命名规范。CameCase标识类名，lower_separated表示变量名。名字格式使用大小写或下划线分隔，或者表示一种类型的变量，例如成员/静态/常量
* 如果要缩写，要用业内公认的缩写方式，例如str，doc，而且每种语言也不同

#### 避免歧义

* 起一个名字时，反问自己别人是否能理解这个名字，是否会联想到其他含义。可能自己的词汇量匮乏，对一个单词只了解一个意思，而其他人知道更多的含义。尽量不用单词的生僻含义。
* 动词作为方法名时，加上宾语可以更明确的表达一个行为的结果
* 边界值使用max和min的修饰，用first和last标识范围，明确范围的开闭区间，对于开闭区间[ )使用begin和end的组合，和STL的一致
* bool变量加上is/has/can/should前缀，明确条件是什么，避免使用正常逻辑的反义，例如XXXNoSignal
* 坚持一个语言的命名风格，例如get和set对于java bean都是访问函数，大家都知道里面不会有复杂的运算，因此可多次调用。list的size()函数原来实现是遍历链表获取个数O(N)，如果用作循环变量中就会严重影响效率了(最新的标准库实现为O(1))。

#### 美化代码

* 一致的布局，等宽字体列对齐，注释也要对齐
* 相似的代码看上去相似，重复的代码用一个公共函数统一实现
* 相关的代码分块放一起形成一个段落，每个段落一个注释
* 变量和函数的声明的顺序：与界面显示或其他地方的定义一致，重要到不重要，字母顺序（没有必要）
* 一致的风格比正确的风格更重要

#### 注释

* 不要写显而易见的废话
* 不要给不好的名字加注释，起个好名字吧！
* 把自己对一段代码的理解写下来，如果是本来有小问题的代码，注明需求或者结论 
* TODO FIXME HACK  XXX表示这里有重要问题
* 给一个常量加注释，写出这个常量值的来源，以便后续别人使用或修改
* 这段代码有什么出人意料的地方？会不会被误用？说明这段代码是怎么工作的，为什么这么做？
* 给一个文件写注释，说明这个文件在系统的作用

#### 言简意赅的注释

* 避免使用代词，以免产生歧义
* 注释的内容要具体，明确的描述行为 `// Count how many newline bytes ('\n') are in the file`
* 可以写一个具体的典型的例子方便理解，例如在解包函数前写一个具体的数据包的例子

#### 控制流

* 条件语句中的条件应该是符合正常的理解顺序，变化量在左侧，预期的固定量在右侧，例如`worktime > THRESHOLD`，对于两个阈值的，还是放中间好读 `MIN < worktime && worktime < MAX`。

* 多分枝条件顺序：1. 简单条件 2. 正向逻辑 3. 特殊条件优先。
* 条件表达式不能有太多判断逻辑，更不能有计算逻辑在分支里面，简单的条件语句还是比if好读。
* C++语法里应该去掉do while，go to,毕竟没人用
* 不管别人怎么认为，我还是觉得不能有多个return在函数中，除非只是判断函数参数不符合预期，只能提前返回。
* 改动代码时，不能只看自己补的这点内容，要结合整体看是否还满足易读的要求。但是大部分情况下，时间和资源的现实决定你只能做最小的改动。
* 循环嵌套条件语句时，可以考虑换一个判断条件方向，让本轮循环continue跳过，从而减少嵌套层次例如：

```
for (int i = 0; i < 100; i++)
{
	if (!alarm[i].trigger) continune;

	// do sth with the alarm
	if (alarm[i].level > MID)
	{
		//....
	}
}
```
* 如果问题不是特别复杂，还是不要用线程、信号量这些让程序的流程复杂化的方法

#### 拆分超长表达式

* 不要将复杂的执行语句放进一个语句中，必要的时候增加一个临时变量，说明一个语句的输出是什么，同时也方便断点调试。循环遍历迭代器时经常有类似问题。
* (!a) && (!b) && (!c) <==> !(a || b || c)
* (!a) || (!b) || (!c) <==> !(a && b && c)
* 当一个问题的判断情况多又复杂时，可以把所有情况用图或表格的方式列举所以情况。
* 对于一个复杂问题，如果正向思考情况太多，可以试试反向思考，条件为否的情况也许会比较少，容易理解，这个时候注意写好注释。

#### 变量与可读性

* 减少变量，变量是否有以下作用：1. 拆分复杂表达式 2. 解释输出结果 3. 多次被使用
* 如果一个变量只是一个标记，可以考虑优化代码结构，把获取标记和使用标记的地方整合起来。
* 尽量减小变量的作用域
* 定义的类的成员变量是否可以作为函数的局部变量，通过函数参数传递即可。
* 把大类拆成独立的小类，本质上也是减少变量的作用域，类内部的变量的作用域只在小类里面了。
* 在使用前再去定义变量，把定义和使用放在一起
* 被改变次数越少的变量更易于理解代码逻辑，例如常量只是被初始化了一次。

